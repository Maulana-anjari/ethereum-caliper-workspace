# =====================================================
#          TEMPLATE KONFIGURASI EKSPERIMEN
# set -a && source .env && set +a && ./run_pipeline.sh
# =====================================================

# --- Pengaturan Jaringan Blockchain ---
NETWORK_ID=477748
COMPOSE_PROJECT_NAME=blockchain_sut
# Endpoint RPC untuk salah satu node Anda
# Catatan: Pada konfigurasi PoA default, Signer-UGM memetakan HTTP di 8545 dan WebSocket di 8546. 
# Nonsigner 1 di port ws: 8546
# Gunakan HTTP di 8557 agar skrip deploy tidak salah menggunakan WS ke port HTTP. http://77.237.244.170:8545
NODE_URL="ws://77.237.244.170:8546"
BLOCKCHAIN_NODE_URL="ws://77.237.244.170:8546"
CONSENSUS="PoA"
TOPOLOGY="3S-1NS"
# Tuning beban jaringan
# Setelah monitoring stabil, tingkatkan laju uji 
# (mis. naikan transactionLoad atau tambah worker) sambil awasi latensi; 
# bila tetap lambat, perpendek BLOCK_TIME atau naikkan BLOCK_GAS_LIMIT di jaringan PoA.
BLOCK_TIME=12
BLOCK_GAS_LIMIT=8000000
BLOCK_GAS_PRICE=10000000000
TX_CONFIRM_BLOCKS=2

# --- Pengaturan Keystore & Akun ---
# Path ke direktori keystore di mesin Anda. Wildcard (*) akan ditangani oleh skrip.
UGM_REMOTE_KEYSTORE_SRC_PATHS="maul@77.237.244.170:~/poa/signer/UGM/volumes/geth/keystore"
ITB_REMOTE_KEYSTORE_SRC_PATHS="maul@89.117.50.181:~/poa/signer/ITB/volumes/geth/keystore"
UI_REMOTE_KEYSTORE_SRC_PATHS="maul@77.237.244.170:~/poa/signer/UI/volumes/geth/keystore"
# UB_REMOTE_KEYSTORE_SRC_PATHS="maul@203.0.113.13:~/poa/signer/UB/volumes/geth/keystore"
# ITS_REMOTE_KEYSTORE_SRC_PATHS="maul@203.0.113.14:~/poa/signer/ITS/volumes/geth/keystore"
KEYSTORE_SRC_PATHS="$HOME/Documents/skripsi/ethereum-caliper-workspace/keystores/UGM,$HOME/Documents/skripsi/ethereum-caliper-workspace/keystores/ITB,$HOME/Documents/skripsi/ethereum-caliper-workspace/keystores/UI"
KEYSTORE_PASSWORDS="pass_signer_1,pass_signer_2,pass_signer_3,pass_signer_4,pass_signer_5"

# Alamat & Private Key akan diisi secara otomatis oleh pipeline

# --- Pengaturan Kontrak Benchmark ---
# Definisikan semua kontrak yang akan diuji di sini
CONTRACT_NAME_MINT="MintCertificate"
CONTRACT_DEFINITION_PATH_MINT="contracts/abi/MintCertificate.json"

CONTRACT_NAME_CPU="CpuStressTest"
CONTRACT_DEFINITION_PATH_CPU="contracts/abi/CpuStressTest.json"

# --- Pengaturan Eksekusi Benchmark ---
# Skenario inti yang akan dijalankan, dipisahkan dengan koma tanpa spasi
# CORE_SCENARIOS="throughput-fixed-load,throughput-step,mixed-workload,worker-scale,certificate-lifecycle,stability-soak,fault-injection"
CORE_SCENARIOS="fault-injection"
# CORE_SCENARIOS="throughput-fixed-load"
# Berapa kali setiap pengujian inti akan diulang (untuk mendapatkan rata-rata)
NUM_TRIALS=1
# Argumen tambahan untuk Caliper, misal: --caliper-flow-only-test
CALIPER_RUN_ARGS="--caliper-report-format html"

# --- Pengaturan Database (untuk log-to-db.js) ---
GEMINI_API_KEY="AIzaSyBf2OtpHwSnslK2xFgt0XR5ac2fmGb5GYo"
# DATABASE
DATABASE_URL="postgresql://maul:passMaul1234@localhost:5432/postgreskripsi?schema=public"
POSTGRES_USER=maul
POSTGRES_PASSWORD=passMaul1234
POSTGRES_DB=skripsi
POSTGRES_HOST_PORT=5432

CONTRACT_GAS_MINT_benchmarkMint=300000
CONTRACT_GAS_READ_certificateNumbers=100000
CONTRACT_GAS_CPU_calculate=1200000

LAM_MINT_TPS=8
LAM_READ_TPS=60
LAM_BURN_TPS=5
LAM_BURN_TOKENS_PER_WORKER=10

# Fault injection hook configuration (disabled by default)
FAULT_INJECT_ENABLED=true
# Default contoh jalur docker-compose lokal; ganti sesuai validator target
FAULT_INJECT_COMPOSE_FILE="/home/maul/poa/signer/UI/docker-compose.yml"
FAULT_INJECT_SERVICE=geth
FAULT_INJECT_DELAY=120
FAULT_INJECT_LOG_FILE="/tmp/fault-injection.log"
FAULT_INJECT_SSH_TARGET="maul@77.237.244.170"
FAULT_INJECT_ENV_FILES="/home/maul/poa/global.env /home/maul/poa/signer/UI/node.env"

# Monitoring
PROMETHEUS_PUSH_URL=http://localhost:9091
PROMETHEUS_HOST_PORT=9090
PUSHGATEWAY_HOST_PORT=9091
GRAFANA_HOST_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin123
DOCKER_EXPORTER_HOST_PORT=9417

OPTIMAL_TPS_OVERRIDE=8 # Override TPS optimal dari eksperimen sebelumnya
